<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ニトロペン舌下投与 音声ガイド</title>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Segoe UI",sans-serif;
background:linear-gradient(180deg,#f7fbff,#eef6ff);color:#0f172a;}
.header{padding:18px 16px 10px;}
.frame-title{border:2px solid #38bdf8;padding:14px 16px;border-radius:14px;background:#f8fcff;text-align:center;}
.frame-title h1{margin:0;font-size:20px;}
.frame-title p{margin:6px 0 0;font-size:14px;color:#475569;}
.note{font-size:12px;color:#475569;margin:12px 16px;}
.main{margin:0 16px 24px;padding:16px;background:#fff;border-radius:18px;box-shadow:0 8px 18px rgba(15,23,42,.08);}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
select{flex:1;max-width:100%;font-size:16px;padding:10px 36px 10px 12px;border-radius:12px;border:1px solid #cbd5f5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
button{font-size:15px;padding:10px 14px;border-radius:12px;border:1px solid #cbd5f5;background:#eff6ff;}
button:active{transform:scale(.98);}
.label{margin-top:14px;font-size:13px;color:#475569;}
.jp{font-size:18px;font-weight:600;margin-top:6px;}
.en{font-size:16px;margin-top:4px;}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;}
audio{width:100%;margin-top:10px;}
.status{margin-top:8px;font-size:13px;color:#475569;}
.hint{margin-top:10px;font-size:12px;color:#64748b;}

/* === Shared sheet styles (same as implant device) === */
.fab-dev{position:fixed;right:16px;bottom:16px;z-index:10000;
width:52px;height:52px;display:flex;align-items:center;justify-content:center;
background:#ffffff;border:2px solid #38bdf8;color:#0f172a;
border-radius:999px;box-shadow:0 10px 22px rgba(15,23,42,.18);
padding:0;font-weight:800;}
.fab-dev svg{width:22px;height:22px;}
.dev-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);
z-index:9998;display:block}
.dev-sheet{position:fixed;left:0;right:0;bottom:0;z-index:9999;
display:block;padding:12px 12px 18px}
.dev-panel{max-width:860px;margin:0 auto;background:#fff;
border-radius:20px;padding:12px 12px 14px;box-shadow:0 18px 40px rgba(15,23,42,.25)}
.dev-list{display:flex;flex-direction:column;gap:10px;max-height:52vh;overflow:auto;padding:4px}
.dev-item{border:1px solid #e2e8f0;border-radius:16px;padding:12px 12px;background:#ffffff}
.dev-jp{font-weight:800;font-size:16px;line-height:1.25}
.dev-en{font-size:13px;color:#475569;margin-top:4px;line-height:1.25}
.dev-audio{margin-top:12px}
.dev-footer{display:flex;justify-content:space-between;gap:10px;align-items:center;margin-top:10px}
.dev-close{background:#eff6ff;border:1px solid #cbd5f5;border-radius:14px;padding:10px 14px;font-size:15px}
.dev-title{font-size:12px;color:#64748b;margin:0 0 8px 6px}

/* Nitro image in sheet */
.nitro-img{
  width:100%;
  max-height:55vh;
  object-fit:contain;
  border-radius:14px;
  background:#0b1220;
}


/* Ensure hidden attribute always hides (Safari/bfcache safety) */
.dev-sheet[hidden], .dev-backdrop[hidden]{display:none !important;}

/* Backdrop */
.dev-backdrop{
  position:fixed; inset:0;
  background:rgba(15,23,42,.35);
  z-index:9998;
}

/* Sheet */
.dev-sheet{
  background:rgba(255,255,255,.0);
}

/* Panel */
.dev-panel{
  max-width:920px;
  margin:0 auto;
}

/* Close button */
.dev-close{background:#eff6ff;border:1px solid #cbd5f5;border-radius:14px;padding:10px 14px;font-size:15px}
.sheet-header{display:flex;justify-content:flex-end;align-items:center;padding:6px 6px 10px;}
.dev-panel{position:relative;}
</style>
</head>
<body>
<div class="header">
  <div class="frame-title">
    <h1>ニトロペン舌下投与</h1>
    <p>English Audio Guide</p>
  </div>
</div>

<p class="note">※ iPhone / iPad / Android で再生できます。最初は「再生」を押してください。</p>

<div class="main">
  <div class="row">
    <select id="sel"></select>
    <button id="prev">← 前</button>
    <button id="next">次 →</button>
  </div>

  <div class="label">日本語（内容）</div>
  <div class="jp" id="jp"></div>

  <div class="label">English (Script)</div>
  <div class="en" id="en"></div>

  <div class="controls">
    <button id="play">▶︎ 再生</button>
    <button id="pause">⏸ 一時停止</button>
    <button id="replay">↻ もう一度</button>
  </div>
<div class="status" id="status">待機中 / Ready</div>
  <audio id="player" controls></audio>

  <div class="hint">
    再生できない場合：消音モード解除、音量、Bluetooth接続を確認してください。
  </div>
</div>

<script>
const STEPS = [
 {preview:"舌の下にお薬を入れます…", jp:"これからお薬を舌の下に入れます。心臓の血管を広げるお薬です。", en:"We’re going to put a medicine under your tongue. It helps widen the blood vessels in your heart."},
 {preview:"舌下錠の説明…", jp:"これは舌下錠です。舌の下で溶けるので、飲み込まないでください。", en:"This is a sublingual tablet that dissolves under your tongue, so please don’t swallow it."},
 {preview:"溶けにくい場合…", jp:"溶けにくい場合は、飴のようになめても構いませんが、噛まないでください。", en:"If it’s hard to dissolve, you can lick it like a candy to help it dissolved, but please don’t chew or bite it."},
 {preview:"頭痛について…", jp:"このお薬は脳の血管も広げるため、軽い頭痛を感じることがありますが、心配いりません。", en:"This medicine can also widen the blood vessels in your brain, so you may feel a light headache, but it’s nothing to worry about."},
 {preview:"頭痛が強い場合…", jp:"多くの方は軽い頭痛ですが、強くなった場合はすぐにお知らせください。", en:"Most patients feel just a mild headache, but if you feel the headache is getting worse, please tell us right away."},
 {preview:"舌を上げて…", jp:"お口を開けて、舌を上げてください。", en:"Please open your mouth and lift your tongue."},
 {preview:"飲み込まないで…", jp:"錠剤は飲み込まないでください。", en:"Please don’t swallow the tablet."},
 {preview:"舌の上で溶かす…", jp:"飴のように舌の上で溶かしてください。", en:"Let it dissolve like a candy on your tongue."},
 {preview:"溶けたら教えて…", jp:"お薬が溶けたら教えてください。", en:"Please let me know when the medicine has dissolved."},
 {preview:"溶けましたか？…", jp:"溶けましたか？まだ舌の下にありますか？", en:"Has it dissolved? Is it still there under your tongue?"}
];

const sel=document.getElementById('sel'),
jp=document.getElementById('jp'),
en=document.getElementById('en'),
player=document.getElementById('player'),
status=document.getElementById('status');

STEPS.forEach((s,i)=>{
 const o=document.createElement('option');
 o.value=i;
 o.textContent=`${String(i+1).padStart(2,'0')}｜${s.jp}`;
 sel.appendChild(o);
});

let idx=0;
function load(i){
 idx=Math.max(0,Math.min(STEPS.length-1,i));
 sel.value=idx;
 jp.textContent=STEPS[idx].jp;
 en.textContent=STEPS[idx].en;
 player.src=`audio/step_${String(idx+1).padStart(2,'0')}.m4a`;
 status.textContent="待機中 / Ready";
}
sel.onchange=()=>load(parseInt(sel.value));
document.getElementById('prev').onclick=()=>load(idx-1);
document.getElementById('next').onclick=()=>load(idx+1);
document.getElementById('play').onclick=()=>player.play();
document.getElementById('pause').onclick=()=>player.pause();
document.getElementById('replay').onclick=()=>{player.currentTime=0;player.play();}
player.onplay=()=>status.textContent="再生中 / Playing";
player.onpause=()=>status.textContent="一時停止 / Paused";
player.onended=()=>status.textContent="待機中 / Ready";

load(0);


</script>

<!-- Nitro image sheet (opens only when user taps the button) -->
<button class="fab-dev" id="nitroImgFab" type="button" aria-label="画像を開く">
  <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
    <path d="M4 5.5A2.5 2.5 0 0 1 6.5 3h11A2.5 2.5 0 0 1 20 5.5v13A2.5 2.5 0 0 1 17.5 21h-11A2.5 2.5 0 0 1 4 18.5v-13Zm2.5-.5a.5.5 0 0 0-.5.5v9.2l3.2-3.2a1.5 1.5 0 0 1 2.1 0l3.8 3.8 1.6-1.6a1.5 1.5 0 0 1 2.1 0l1.2 1.2V5.5a.5.5 0 0 0-.5-.5h-11ZM6 18.5c0 .28.22.5.5.5h11c.28 0 .5-.22.5-.5v-2.1l-2.3-2.3-2.3 2.3-4.9-4.9L6 14.1v4.4Z"></path>
    <path d="M9 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"></path>
  </svg>
</button>
<div class="dev-backdrop" id="nitroSheetBackdrop" hidden></div>
<div class="dev-sheet" id="nitroSheet" role="dialog" aria-modal="true" aria-label="nitro image" hidden>
  <div class="dev-panel">
    <div class="sheet-header">
      <button class="dev-close" id="nitroSheetClose" type="button" aria-label="閉じる">閉じる</button>
    </div>
    <div style="padding:6px;">
      <img class="nitro-img" src="img/nitropen_image.jpg" alt="ニトロペン投与イメージ図">
    </div>
    <div class="dev-footer" style="justify-content:flex-end;">
      <div style="font-size:12px;color:#64748b;">タップで拡大できます</div>
    </div>
  </div>
</div>

<script>
// --- Nitro image sheet controls ---
(function(){
  const fab = document.getElementById('nitroImgFab');
  const sheet = document.getElementById('nitroSheet');
  const backdrop = document.getElementById('nitroSheetBackdrop');
  const closeBtn = document.getElementById('nitroSheetClose');

  if (!fab || !sheet || !backdrop || !closeBtn) return;

  closeSheet();

  function openSheet(){
    sheet.hidden = false;
    backdrop.hidden = false;
    // hide FAB while sheet is open
    fab.hidden = true;
    // prevent background scroll
    document.documentElement.style.overflow = 'hidden';
    document.body.style.overflow = 'hidden';
  }

  function closeSheet(){
    sheet.hidden = true;
    backdrop.hidden = true;
    // show FAB again
    fab.hidden = false;
    document.documentElement.style.overflow = '';
    document.body.style.overflow = '';
  }

  // Always start closed (handles Safari bfcache / reload restoring open state)
  window.addEventListener('pageshow', () => closeSheet());

  fab.addEventListener('click', openSheet);
  closeBtn.addEventListener('click', closeSheet);
  backdrop.addEventListener('click', closeSheet);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeSheet(); });
})();
</script>

</body>
</html>
